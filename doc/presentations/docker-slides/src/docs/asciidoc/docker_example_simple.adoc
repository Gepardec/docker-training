= Docker Example Simple
Thomas Herzog
2018-11-09
:author: Thomas Herzog
:revnumber: {project-version}
:example-caption!:
ifndef::imagesdir[:imagesdir: images]
ifndef::sourcedir[:sourcedir: ../../main/java]
:title-slide-background-image: 70s.jpg
:title-slide-transition: zoom
:title-slide-transition-speed: fast
:customcss: slides.css
:source-highlighter: highlightjs

== What do we want to learn?

image:docker_example_simple.svg[title="Simple example",caption="Simple example",align=center]

[.text-left]
* Writing Dockerfiles
* Building Docker Images
* Manage Docker Volumes
* Manage Docker Containers

== The Dockerfile

[source,bash]
-----
FROM library/alpine:3.6
MAINTAINER ...
RUN ...
VOLUME ...
ENV PREFIX "default"
CMD "while true; do sleep 3s; COUNT=${COUNT:-1}; touch /work/${PREFIX}_${COUNT}; ls /work -lrta; COUNT=$((COUNT+1)); done"
-----

[.text-left]
* Create a Dockerfile for the application
* We need a directory called ``/work``
* We need a Docker Volume for the directory ``/work``
* See: link:https://docs.docker.com/engine/reference/builder/[]

=== Solution

[source,bash]
----
include::./examples/simple/Dockerfile[]
----

== The Docker Image

[source, bash]
-----
docker image ...
-----

* Build the Docker Image with the tag __simple:latest__
* Build it 
** ones within the directory with the Dockerfile 
** and ones with explicitly defining the Dockerfile to use
* See: link:https://docs.docker.com/engine/reference/commandline/image_build/[]

=== Solution

[source, bash]
-----
include::./examples/simple/commands.sh[tag=build]
-----

== The Docker Volume

[small]
For now, we had no persistence, therefore we need an Docker Volume

[source, bash]
-----
docker volume ...
-----

* Create the Docker Volumes with name __simple-1-vol__ and __simple-2-vol__
* Each Docker Container shall have its own volume

=== Solution
[source, bash]
-----
include::./examples/simple/commands.sh[tag=volume]
-----

[[anchor-slide-docker-container]]
== The Docker Container

[source, bash]
-----
docker container ...
-----

* Create Docker Containers with the name __simple-1__, __simple-2__ 
* Assign the created Docker Volumes
* Provide the env var __PREFIX__
* Start the Docker Containers 
* Show the Docker Container logs 
* Stop the Docker Containers
* Delete the Docker Containers
* See: link:https://docs.docker.com/engine/reference/commandline/container/[]

=== Solution

[source, bash]
-----
include::./examples/simple/commands.sh[tag=container]
-----

== Play around

* What happens if we assign the same Docker Volume to both Docker Containers with same __PREFIX__ set? +
* What happens if we assign the same Docker Volume to both Docker Containers with different __PREFIX__ set? +
* What happens if we don't define a container name? +
  
=== Solution

* Both write files with the same name, one overwrites the other
* Both write files with different names, so no problem
* Then you have to use the hash value generated by Docker

== Cleanup
[source, bash]
-----
# 1. delete the containers
docker container ...

# 2. delete the image
docker image ...

# 3. Delete the volumes
docker volume ...
-----

* Why is the order important?
* Why are Docker Volumes not deleted automatically?

=== Solution

[source, bash]
-----
include::./examples/simple/commands.sh[tag=cleanup]
-----

* We cannot delete resources, other depend on
* Data is too important, therefore must be deleted manually